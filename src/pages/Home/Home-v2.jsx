import { useState, useEffect } from "react";
import { Link } from "react-router-dom";
import Sidebar from "../../components/Sidebar-v2";
import api from "../../services/api";
import "./Home-v2.css";

function Home() {
  const [stats, setStats] = useState({
    totalItens: 0,
    totalBeneficiarios: 0,
    totalDoacoes: 0,
    totalMovimentos: 0
  });
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchStats = async () => {
      try {
        const [itens, beneficiarios, movimentos] = await Promise.all([
          api.get("/item"),
          api.get("/beneficiario"),
          api.get("/movimento")
        ]);

        const doacoes = movimentos.data.filter(m => 
          m.tipo?.toLowerCase() === "doacao" || 
          m.tipo?.toLowerCase() === "entrada"
        );

        setStats({
          totalItens: itens.data.reduce((sum, item) => sum + (item.quantidade || 0), 0),
          totalBeneficiarios: beneficiarios.data.length,
          totalDoacoes: doacoes.length,
          totalMovimentos: movimentos.data.length
        });
      } catch (error) {
        console.error("Erro ao carregar estat√≠sticas:", error);
      } finally {
        setLoading(false);
      }
    };

    fetchStats();
  }, []);

  const quickActions = [
    {
      to: "/criarDoacao",
      icon: "ü§ù",
      title: "Registrar Doa√ß√£o",
      description: "Adicione uma nova doa√ß√£o ao sistema"
    },
    {
      to: "/criarItem",
      icon: "üëî",
      title: "Cadastrar Pe√ßa",
      description: "Adicione um novo item ao estoque"
    },
    {
      to: "/criarBeneficiario",
      icon: "üë•",
      title: "Novo Benefici√°rio",
      description: "Cadastre um novo benefici√°rio"
    },
    {
      to: "/criarMovimento",
      icon: "üìä",
      title: "Nova Movimenta√ß√£o",
      description: "Registre entrada ou sa√≠da"
    }
  ];

  return (
    <div className="home-wrapper">
      <Sidebar />
      <div className="home-container">
        {/* Hero Section */}
        <section className="home-hero">
          <div className="hero-content">
            <h1 className="hero-title">Bem-vindo ao SANEM!</h1>
            <p className="hero-subtitle">Transformando vidas atrav√©s da solidariedade</p>
            
            {!loading && (
              <div className="hero-stats">
                <div className="hero-stat">
                  <span className="hero-stat-value">{stats.totalItens}</span>
                  <span className="hero-stat-label">Pe√ßas em estoque</span>
                </div>
                <div className="hero-stat">
                  <span className="hero-stat-value">{stats.totalDoacoes}</span>
                  <span className="hero-stat-label">Doa√ß√µes recebidas</span>
                </div>
                <div className="hero-stat">
                  <span className="hero-stat-value">{stats.totalBeneficiarios}</span>
                  <span className="hero-stat-label">Benefici√°rios</span>
                </div>
              </div>
            )}
          </div>
        </section>

        {/* Dashboard Content */}
        <div className="home-content">
          {/* Estat√≠sticas Detalhadas */}
          <section>
            <div className="section-header">
              <h2 className="section-title">Estat√≠sticas</h2>
              <p className="section-subtitle">Vis√£o geral do sistema</p>
            </div>

            {loading ? (
              <div className="loading-container">
                <div className="loading-spinner"></div>
              </div>
            ) : (
              <div className="stats-grid">
                <div className="stat-card primary">
                  <div className="stat-card-header">
                    <div className="stat-card-icon">üëî</div>
                  </div>
                  <div className="stat-card-value">{stats.totalItens}</div>
                  <div className="stat-card-label">Pe√ßas em Estoque</div>
                  <div className="stat-card-trend trend-positive">
                    ‚Üë Atualizado agora
                  </div>
                </div>

                <div className="stat-card success">
                  <div className="stat-card-header">
                    <div className="stat-card-icon">ü§ù</div>
                  </div>
                  <div className="stat-card-value">{stats.totalDoacoes}</div>
                  <div className="stat-card-label">Doa√ß√µes Recebidas</div>
                  <div className="stat-card-trend trend-positive">
                    ‚Üë Este m√™s
                  </div>
                </div>

                <div className="stat-card warning">
                  <div className="stat-card-header">
                    <div className="stat-card-icon">üë•</div>
                  </div>
                  <div className="stat-card-value">{stats.totalBeneficiarios}</div>
                  <div className="stat-card-label">Benefici√°rios Cadastrados</div>
                  <div className="stat-card-trend trend-positive">
                    ‚Üë Total
                  </div>
                </div>

                <div className="stat-card info">
                  <div className="stat-card-header">
                    <div className="stat-card-icon">üìä</div>
                  </div>
                  <div className="stat-card-value">{stats.totalMovimentos}</div>
                  <div className="stat-card-label">Movimenta√ß√µes Totais</div>
                  <div className="stat-card-trend trend-positive">
                    ‚Üë Todas
                  </div>
                </div>
              </div>
            )}
          </section>

          {/* A√ß√µes R√°pidas */}
          <section>
            <div className="section-header">
              <h2 className="section-title">A√ß√µes R√°pidas</h2>
              <p className="section-subtitle">Acesso r√°pido √†s principais funcionalidades</p>
            </div>

            <div className="quick-actions">
              {quickActions.map((action, index) => (
                <Link
                  key={index}
                  to={action.to}
                  className="action-card"
                >
                  <div className="action-card-icon">{action.icon}</div>
                  <h3 className="action-card-title">{action.title}</h3>
                  <p className="action-card-description">{action.description}</p>
                </Link>
              ))}
            </div>
          </section>

          {/* Atividades Recentes */}
          <section className="activity-section">
            <div className="section-header">
              <h2 className="section-title">Atividades Recentes</h2>
              <p className="section-subtitle">√öltimas movimenta√ß√µes do sistema</p>
            </div>

            <ul className="activity-list">
              <li className="activity-item">
                <div className="activity-icon">ü§ù</div>
                <div className="activity-content">
                  <div className="activity-title">Nova doa√ß√£o registrada</div>
                  <div className="activity-description">
                    10 pe√ßas de roupa adicionadas ao estoque
                  </div>
                </div>
                <div className="activity-time">Hoje, 14:30</div>
              </li>
              <li className="activity-item">
                <div className="activity-icon">üë•</div>
                <div className="activity-content">
                  <div className="activity-title">Benefici√°rio cadastrado</div>
                  <div className="activity-description">
                    Novo benefici√°rio adicionado ao sistema
                  </div>
                </div>
                <div className="activity-time">Hoje, 13:15</div>
              </li>
              <li className="activity-item">
                <div className="activity-icon">üì¶</div>
                <div className="activity-content">
                  <div className="activity-title">Entrega realizada</div>
                  <div className="activity-description">
                    5 pe√ßas entregues a benefici√°rios
                  </div>
                </div>
                <div className="activity-time">Ontem, 16:45</div>
              </li>
            </ul>
          </section>
        </div>
      </div>
    </div>
  );
}

export default Home;

